{% extends "base.html" %}
{% block title %}USER SPEECH BOARD{% endblock %}
{% block head %}
    {{super()}}
    <script language="JavaScript">

        $(document).ready(function(){
            var sv_count = 1;

            // ACT LIST 목록을 클릭하면
            $(".MyActList").click(function(){
                var act = $(this).text();

                $.ajax({
                   type:"POST",
                   url:"/ajax_find_by_act",
                   data:{'act' : act},
                   success:function(res){
                        var json_obj = JSON.parse(res);
                        var act = json_obj['act'];
                        var category = json_obj['category'];
                        var topic = json_obj['topic'];

                        $("#act_id").val(act);
                        $("#cat_id").val(category);
                        $("#top_id").val(topic);
                   },
                    error:function(error){
                       alert("ERROR : " + error);
                    }
                });
            });


            // slot-value 추가 버튼을 클릭하면
            $(".sv_add_btn").click(function(){
                alert('!');
                sv_count += 1;
                $(".MySV").append('<input type="text" class="form-control mt-1" id="s_id_' + sv_count + '"> : <input type="text" class="form-control" id="v_id_' + sv_count + '"> <button class="btn btn-success sv_add_btn" id="sv_add_btn_id_' + sv_count + '" type="button"><i class="fas fa-plus"></i></button> <button class="btn btn-warning sv_del_btn" id="sv_del_btn_id_' + sv_count + '" type="button"><i class="fas fa-minus"></i></button>');
            });

            // slot-value 삭제 버튼을 클릭하면
            $(".sv_del_btn").click(function(){

                //삭제하고 마이너스해야함
                sv_count -= 1;

            });

            // 모달창에서 '예'를 클릭하면
            $(".MyInputClass").click(function(){

                $(".MyFormClass").attr("method", "post");
                $(".MyFormClass").attr("action", "/text_board/delete");
                $(".MyFormClass").submit();
            });



            // '추가' 버튼을 클릭하면
            $("#speech_add_btn_id").click(function(){

            });



        });



        function trigger_modal(id){
            $(".modal-footer #hidden_id").val(id);
            $("#myModal" + id).modal();
        }



        function order_text(id){
            // 1 이면 오름차순 정렬
            // 0 이면 내림차순 정렬
            var url = $(location).attr('href');
            var asc1_desc0 = getParameterByName(url, 'asc1_desc0');
            var search_msg = getParameterByName(url, 'search_msg');
            var article_id = getParameterByName(url, 'article_id');
            var inc_num = getParameterByName(url, 'inc_num');
            var before_selected_col = getParameterByName(url, 'col_name');
            var ordering = 1;

            if(id == before_selected_col){
                if(asc1_desc0 == 1) {
                    ordering = 0;
                }
                else {
                    ordering = 1;
                }
            }
            else {
                ordering = 1;
            }


            // 검색한 경우 ordering
            if(search_msg){
                if(inc_num){
                    location.replace("/" + 'text_board' + "/order?article_id=" + article_id + "&col_name=" + id + "&asc1_desc0=" + ordering + "&search_msg=" + search_msg + "&inc_num=" + inc_num);
                }
                else{
                    location.replace("/" + 'text_board' + "/order?article_id=" + article_id + "&col_name=" + id + "&asc1_desc0=" + ordering + "&search_msg=" + search_msg);
                }
            }
            // 검색하지 않았을 경우 ordering
            else{
                if(inc_num){
                    location.replace("/" + 'text_board' + "/order?article_id=" + article_id + "&col_name=" + id + "&asc1_desc0=" + ordering + "&inc_num=" + inc_num);
                }
                else{
                    location.replace("/" + 'text_board' + "/order?article_id=" + article_id + "&col_name=" + id + "&asc1_desc0=" + ordering);
                }

            }


        }

        function search_text(){
            var search_msg = $("#SearchText").val().trim();

            if(search_msg == ''){
                alert('검색어를 입력해주십시오.');
            }
            else{
                $("#frm").attr("method", "get");
                $("#frm").attr("action", "/text_board/search");
                $("#frm").submit();
            }

        }


        function getParameterByName(url, param_name){
            var after_part = url.split("?")[1];
            var param_arr = after_part.split("&");

            for(var i = 0 ; i < param_arr.length ; i++)
            {
                var key_value = param_arr[i].split("=");

                if(key_value[0] === param_name)
                {
                    return key_value[1];
                }
            }
        }
    </script>


{% endblock %}

{% block flash %}
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flashes my-4">
                {% for category, message in messages %}
                    <p class="{{category}} text-center" style="font-size:20px">{{message}}</p>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
{% endblock %}

{% block nav %}
<ul class="navbar-nav">
    <li class="nav-item">
        <a class="nav-link" href="{{url_for('act_manager')}}">Act Manager</a>
    </li>

    <li class="nav-item active">
        <a class="nav-link" href="{{url_for('text_board', col_name='sent_id', asc1_desc0=1)}}">User Speech Board</a>
    </li>

    <li class="nav-item">
        <a class="nav-link" href="{{url_for('export')}}">Export</a>
    </li>
</ul>

<ul class="navbar-nav ml-auto">
    <li class="nav-item"><a class="nav-link" href="#">{{user_id}}님 접속중...</a></li>
    <li class="nav-item"><a class="nav-link" href="{{url_for('logout')}}"><i class="fa-blink"><i class="fas fa-sign-out-alt"></i></i> 로그아웃</a></li>
</ul>
{% endblock %}


{% block content %}

    <div class="container-fluid">


        <div class="row">
            <form class="form-inline my-2" id="frm" role="search">
                <div class="col-md-10">
                    <div class="form-group">
                        <input type="text" class="form-control col-md-12" id="SearchText" name="search_msg" placeholder="문장을 검색해주세요.">
                        <!--<input type="hidden" name="page" value="{{page}}">-->
                    </div>
                </div>

                <div class="form-group">
                    <input type="submit" class="btn btn-primary" onclick="search_text()" value="검색">
                </div>
            </form>
        </div>


        <!--
        {% if article_title is defined and article_title is not none %}
        <div class="row my-4">

            <div class="col col-2 text-left">
                {% if article_id == '0' %}
                    <input type="button" class="btn btn-primary btn-block my-2" value="모든 기사 목록" onclick="location.href='/article_board?page=1&col_name=article_id&asc1_desc0=1';">
                {% else %}
                    {% if article_id is not defined or article_id == 'None' %}
                        <input type="button" class="btn btn-primary btn-block" value="해당 카테고리 목록" onclick="location.href='/article_board';">
                    {% else %}
                        <input type="button" class="btn btn-primary btn-block" value="해당 카테고리 목록" onclick="location.href='/article_board?col_name=article_id&page=1&asc1_desc0=1&sid1={{sid1}}&sid2={{sid2}}';">
                    {% endif %}
                    <input type="button" class="btn btn-primary btn-block my-2" value="모든 기사 목록" onclick="location.href='/article_board?page=1&col_name=article_id&asc1_desc0=1';">
                {% endif %}
            </div>


            <div class="col">
                <div class="row">
                    <div class="card border-dark mx-1">
                        <div class="card-body">
                            <div class="card-title">기사 번호</div>

                            <div clsas="card-text">
                                <div class="col text-center font-weight-bold">
                                    {{article_id}}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card border-dark mx-1">
                        <div class="card-body">
                            <div class="card-title">기사 제목</div>

                            <div clsas="card-text">
                                <div class="col text-center font-weight-bold">
                                    {{article_title}}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card border-dark mx-1">
                        <div class="card-body">
                            <div class="card-title">대분류</div>

                            <div clsas="card-text">
                                <div class="col text-center font-weight-bold">
                                    {{sid1}}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card border-dark mx-1">
                        <div class="card-body">
                            <div class="card-title">소분류</div>

                            <div clsas="card-text">
                                <div class="col text-center font-weight-bold">
                                    {{sid2}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col col-2 text-right">
                <input type="button" class="btn btn-primary" value="글쓰기" onclick="location.href='/text_board/create?page={{page}}';">
            </div>
        </div>

        {% else %}
        <div class="row my-4">
            <div class="col col-2 text-left">
                <input type="button" class="btn btn-primary btn-block my-2" value="모든 기사 목록" onclick="location.href='/article_board?col_name=article_id&page=1&asc1_desc0=1';">
            </div>

            <div class="col text-right">
                <input type="button" class="btn btn-primary" value="글쓰기" onclick="location.href='/text_board/create?page={{page}}';">
            </div>
        </div>
        {% endif %}
        -->


        <!--
        <div class="row">
            <div class="col-2"></div>

            <label class="btn btn-primary mr-2">
                <input type="radio" name="option" checked="checked" id="option1" value="모든 문장"> 모든 문장 ({{inc_num_none_count}})
            </label>

            <label class="btn btn-primary mr-2">
                <input type="radio" name="option" id="option2" value="숫자 포함 문장"> 숫자 포함 문장 ({{inc_num_1_count}})
            </label>

            <label class="btn btn-primary">
                <input type="radio" name="option" id="option3" value="숫자 미포함 문장"> 숫자 미포함 문장 ({{inc_num_0_count}})
            </label>
        </div>
        -->


        <div class="row">

            <div class="col-2">
                {% include 'act_list.html' ignore missing %}
            </div>


            <div class="col">

                <div class="card border-dark my-2">
                    <form id="speech_add_frm_id">
                        <div class="row">
                            <div class="col">
                                <div class="form-inline">

                                    <div class="card-body">
                                            <div class="card-title font-weight-bold">Act</div>

                                            <div clsas="card-text">
                                                <div class="col font-weight-bold">
                                                    <input type="text" class="form-control" id="act_id" placeholder="액트 입력">
                                            </div>
                                        </div>
                                    </div>


                                    <div class="card-body">
                                        <div class="card-title font-weight-bold">Category</div>

                                        <div clsas="card-text">
                                            <div class="col font-weight-bold">
                                                <input type="text" class="form-control" id="cat_id" placeholder="카테고리 입력">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card-body">
                                            <div class="card-title font-weight-bold">Topic</div>

                                            <div clsas="card-text">
                                                <div class="col font-weight-bold">
                                                    <input type="text" class="form-control" id="top_id" placeholder="토픽 입력">
                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <div class="form-inline">
                                    <div class="card-body" style="width:38rem">
                                        <div class="card-title font-weight-bold">User Speech</div>

                                        <div clsas="card-text">
                                            <div class="col-xl-12">
                                                <div class="input-group font-weight-bold">
                                                    <input type="text" class="form-control" id="us_id" placeholder="예상 발화문 입력">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-inline">
                                    <div class="card-body col-8">
                                        <div class="card-title font-weight-bold">Slot : Value</div>

                                        <div clsas="card-text">
                                            <div class="col font-weight-bold MySV">
                                                <input type="text" class="form-control" id="s_id_1">
                                                :
                                                <input type="text" class="form-control" id="v_id_1">

                                                <button class="btn btn-success sv_add_btn" id="sv_add_btn_id_1" type="button"><i class="fas fa-plus"></i></button>
                                                <button class="btn btn-warning sv_del_btn" id="sv_del_btn_id_1" type="button"><i class="fas fa-minus"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-2">
                                <input type="button" class="btn btn-block btn-primary font-weight-bold" id="speech_add_btn_id" style="height:100%" value="추가">
                            </div>
                        </div>



                    </form>
                </div>

                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <div>
                                {% set cname_1 = 'fas fa-sort' %}
                                {% if asc1_desc0 == '0' and col_name == 'sent_id' %}
                                    {% set cname_1 = 'fas fa-sort-down' %}
                                {% elif asc1_desc0 == '1' and col_name == 'sent_id' %}
                                    {% set cname_1 = 'fas fa-sort-up' %}
                                {% else %}
                                    {% set cname_1 = 'fas fa-sort' %}
                                {% endif %}
                                </div>
                                <th style="width : 11%" class="text-center">ID<button class="btn" id="sent_id" onclick="order_text(id)"><i class='{{cname_1}}'></i></button></th>
                                <th class="text-center">User Speech</th>
                                <th style="width : 11%" class="text-center">Category</th>
                                <th style="width : 15%" class="text-center">Topic</th>
                                <th style="width : 15%" class="text-center">Act</th>
                                <th style="width : 11%" class="text-center">Slot : Value</th>
                                <th></th>
                            </tr>
                        </thead>

                        <tbody>
                        {% for row in board_total %}
                            <tr>
                                <td class="text-center">{{row.sent_id}}</td>

                                {% if is_all_sents is defined %}
                                    {% set add_behind = "&is_all_sents=1" %}
                                {% else %}
                                    {% set add_behind = "" %}
                                {% endif %}

                                {% if row.sent_confirm == 1 %}
                                <td>
                                    {% if search_msg is defined %}
                                        <a href="/text_board/edit?article_id={{row.ArticleTable_article_id}}&sent_id={{row.sent_id}}&page={{page}}&search_msg={{search_msg}}{{add_behind}}">{{row.sent_converted}}</a>
                                    {% else %}
                                        <a href="/text_board/edit?article_id={{row.ArticleTable_article_id}}&sent_id={{row.sent_id}}&page={{page}}{{add_behind}}">{{row.sent_converted}}</a>
                                    {% endif %}
                                </td>
                                {% else %}
                                <td>
                                    {% if search_msg is defined %}
                                        <a href="/text_board/edit?article_id={{row.ArticleTable_article_id}}&sent_id={{row.sent_id}}&page={{page}}&search_msg={{search_msg}}{{add_behind}}">{{row.sent_original}}</a>
                                    {% else %}
                                        <a href="/text_board/edit?article_id={{row.ArticleTable_article_id}}&sent_id={{row.sent_id}}&page={{page}}{{add_behind}}">{{row.sent_original}}</a>
                                    {% endif %}
                                </td>
                                {% endif %}

                                <td class="text-center">{{row.article_id}}</td>
                                {% if row.article_collected_date|string == '1900-01-01 00:00:00' %}
                                    <td class="text-center">-</td>
                                {% else %}
                                    <td class="text-center">{{row.article_collected_date}}</td>
                                {% endif %}

                                {% if row.sent_modified_date|string == '1900-01-01 00:00:00' %}
                                    <td class="text-center">-</td>
                                {% else %}
                                    <td class="text-center">{{row.sent_modified_date}}</td>
                                {% endif %}

                                <td class="text-center">{{row.sent_converted_count}}</td>

                                <td class="text-center">
                                    <input type="button" class="btn btn-danger btn-sm" onclick="trigger_modal('{{row.id}}')" value="삭제">
                                </td>

                            </tr>
                        {% endfor %}

                        </tbody>
                    </table>


            </div>
        </div>


        <!--
        <div class="row my-4">
            <div class="col col-2 text-left">
                {% if article_title is defined and article_title is not none %}
                    {% if article_id == '0' %}
                        <input type="button" class="btn btn-primary btn-block my-2" value="모든 기사 목록" onclick="location.href='/article_board?page=1&col_name=article_id&asc1_desc0=1';">
                    {% else %}
                        <input type="button" class="btn btn-primary btn-block" value="해당 카테고리 목록" onclick="location.href='/article_board?col_name=article_id&page=1&asc1_desc0=1';">
                        <input type="button" class="btn btn-primary btn-block my-2" value="모든 기사 목록" onclick="location.href='/article_board?page=1&col_name=article_id&asc1_desc0=1';">
                    {% endif %}
                {% else %}
                    <input type="button" class="btn btn-primary btn-block my-2" value="모든 기사 목록" onclick="location.href='/article_board?page=1&col_name=article_id&asc1_desc0=1';">
                {% endif %}
            </div>

            <div class="col text-right">
                <input type="button" class="btn btn-primary" value="글쓰기" onclick="location.href='/text_board/create?page={{page}}';">
            </div>
        </div>
        -->


        {% for row in board_total %}
        <!-- Modal -->
        <div id="myModal{{row.id}}" class="modal fade" role="dialog">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title"><i class="fas fa-exclamation-triangle"></i>경고</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <div class="modal-body">
                        <p>{{row.id}}번 발화문을 정말 삭제하시겠습니까?</p>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger mr-auto" data-dismiss="modal">아니오</button>
                        <form class="MyFormClass">
                            <input type="submit" class="btn btn-primary MyInputClass" data-dismiss="modal" value="예">
                            <input type="hidden" name="id" id="hidden_id" value="">
                            <input type="hidden" name="table_name" value="speech">
                            <!--<input type="hidden" name="page" value="{{page}}">-->
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}

        <a id="back-to-top" href="#" class="btn btn-primary btn-lg back-to-top" role="button" title="Click to return on the top page" data-toggle="tooltip" data-placement="left"><i class="fas fa-arrow-circle-up fa-2x"></i></a>

    </div>
{% endblock %}
